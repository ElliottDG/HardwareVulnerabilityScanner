import { Component } from '@angular/core';
import { FormControl, FormGroup } from '@angular/forms';
import { DomSanitizer } from '@angular/platform-browser';
import { ValidationService } from '../services/validation.service';
import { MatSnackBar, MatSnackBarConfig } from '@angular/material/snack-bar';
import { PasswordSnackComponent } from '../visual-components/password-snack/password-snack.component';

@Component({
  selector: 'app-login',
  templateUrl: './login.component.html',
  styleUrls: ['./login.component.scss']
})
export class LoginComponent {

  constructor(private sanitizer: DomSanitizer, private validator: ValidationService,
    private _snackBar: MatSnackBar) {}

  title: String = "Login";
  buttonText: String = "Login";
  toggleButtonText: String = "Register";
  registerMode: boolean = false;

  loginForm = new FormGroup({
    username: new FormControl<String>(''),
    password: new FormControl<String>('')
  });

  onSubmit(): void {
    // no storing unsafehtml
    if (this.loginForm.value.password) {
      this.sanitizer.sanitize(1, this.loginForm.value.password);
    }
    if (this.loginForm.value.username) {
      this.sanitizer.sanitize(1, this.loginForm.value.username);
    }

    if (this.registerMode) {
      // TODO: register deal with html return
      let validateErrors = this.validator.validatePassword(this.loginForm.value.password as string);
      let configError: MatSnackBarConfig = {
        duration: 30000,
        panelClass: ['warn-snackbar']
      };
      if (validateErrors.length>0) {
        this._snackBar.openFromComponent(PasswordSnackComponent, {
          data: validateErrors,
          ...configError
        });
      }
    } else {
      // TODO: login - forward to user page
    }
  }

  registerToggle() : void {
    this.registerMode = !this.registerMode;
    if (!this.registerMode) {
      this.loginForm.reset();
      this.title = "Login";
      this.buttonText = "Login";
      this.toggleButtonText = "Register"; 
    } else {
      this.loginForm.reset();
      this.title = "Register";
      this.buttonText = "Register";
      this.toggleButtonText = "Login";
    }
  }

}
