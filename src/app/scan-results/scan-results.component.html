<app-vulnerability-confirmation
  [numOfVulnerabilities]="numOfVulnerabilities"
></app-vulnerability-confirmation>
<div class="descriptionAndGraph">
  <mat-card>
    <mat-card-header>
      <mat-card-title>Your Scan Summary</mat-card-title>
      <mat-card-subtitle
        >Hardware Vulnerability Scanner - Scan ID:
      </mat-card-subtitle>
    </mat-card-header>
    <mat-divider class="divider"></mat-divider>
    <mat-card-content class="mat-body-1">
      Below is a table of all the vulnerabilities associated with any reachable
      connected devices. Please take the time to look through the table and
      follow the links to the associated CVE pages to find out more information
      about your vulnerable devices.
      <br /><br />
      If you would like to track your progress, then please make an account and
      rescan to mark vulnerabilities as remediated.
    </mat-card-content>
    <mat-card-actions>
      <button mat-raised-button color="primary" (click)="exportToPdf()">
        Export to PDF
      </button>
    </mat-card-actions>
  </mat-card>
  <mat-card>
    <mat-card-header>
      <mat-card-title>Scan Results</mat-card-title>
      <mat-card-subtitle>Powered by ngx-charts</mat-card-subtitle>
    </mat-card-header>
    <mat-divider class="divider"></mat-divider>
    <mat-card-content class="mat-typography">
      <ngx-charts-advanced-pie-chart
        [animations]="animations"
        [scheme]="'flame'"
        [gradient]="gradient"
        [results]="single"
        [view]="view"
      >
      </ngx-charts-advanced-pie-chart>
    </mat-card-content>
  </mat-card>
</div>

<mat-card class="table">
  <mat-card-header>
    <mat-card-title>Scan Results Table</mat-card-title>
  </mat-card-header>
  <mat-divider class="divider"></mat-divider>
  <mat-card-content class="mat-body-1">
    <table #table mat-table [dataSource]="dataSource">
      <!-- Finding Column -->
      <ng-container matColumnDef="finding">
        <th mat-header-cell *matHeaderCellDef>Finding</th>
        <td mat-cell *matCellDef="let element">{{ element.finding }}</td>
      </ng-container>

      <!-- Device Column -->
      <ng-container matColumnDef="device">
        <th mat-header-cell *matHeaderCellDef>Device</th>
        <td mat-cell *matCellDef="let element">{{ element.device }}</td>
      </ng-container>

      <!-- Severity Column -->
      <ng-container matColumnDef="severity">
        <th mat-header-cell *matHeaderCellDef>Severity</th>
        <td mat-cell *matCellDef="let element">
          <div
            class="divCell"
            [ngStyle]="{
              'background-color':
                element.severity < 3.5
                  ? '#bfe3b4'
                  : element.severity < 7
                  ? '#ffe37a'
                  : '#f9bcbc'
            }"
          >
            {{ element.severity }}
          </div>
        </td>
      </ng-container>

      <!-- CVE Link Column -->
      <ng-container matColumnDef="cveLink">
        <th mat-header-cell *matHeaderCellDef>CVE Link</th>
        <td mat-cell *matCellDef="let element">
          <a
            mat-flat-button
            color="primary"
            href="{{ element.cveLink }}"
            target="_blank"
            >{{ element.finding }}</a
          >
        </td>
      </ng-container>

      <!-- cwe Column -->
      <ng-container matColumnDef="primaryCwe">
        <th mat-header-cell *matHeaderCellDef>CWE Link</th>
        <td mat-cell *matCellDef="let element">
          <a
            mat-flat-button
            color="primary"
            href="{{ CWELINK }}{{ getCWENumber(element.cwe) }}.html"
            target="_blank"
            >{{ element.cwe }}</a
          >
        </td>
      </ng-container>

      <!-- Status Column -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef>Status</th>
        <td mat-cell *matCellDef="let element">
          <div
            class="divCell"
            [ngStyle]="{
              'background-color':
                element.status === 'Vulnerable' ? '#f9bcbc' : '#bfe3b4'
            }"
          >
            {{ element.status }}
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
  </mat-card-content>
</mat-card>
