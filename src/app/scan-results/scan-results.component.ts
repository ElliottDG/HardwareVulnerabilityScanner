import { Component, Input, ViewChild } from '@angular/core';
import { single } from '../data';
import { NavigationEnd, Router } from '@angular/router';
import { filter } from 'rxjs/operators';
import { MatTable, MatTableDataSource } from '@angular/material/table';

@Component({
  selector: 'app-scan-results',
  templateUrl: './scan-results.component.html',
  styleUrls: ['./scan-results.component.scss'],
})
export class ScanResultsComponent {
  single: any[] = single;
  @Input() devices: any;

  @ViewChild(MatTable) table!: MatTable<any>;

  CWELINK: string = 'https://cwe.mitre.org/data/definitions/';

  constructor(private router: Router) {
    this.router.events
      .pipe(filter((event) => event instanceof NavigationEnd))
      .subscribe(() => {
        const state = this.router.getCurrentNavigation()?.extras.state ?? {};
        // Concatenate elements of 'data' to 'dataSource'
        this.dataSource.data = state['data'];
      });
  }

  exportToPdf(): void {
    console.log(this.dataSource);
  }

  getCWENumber(cwe: string): string {
    return cwe.slice(4);
  }

  view: [number, number] = [650, 165];
  gradient: boolean = true;
  animations: boolean = true;
  displayedColumns: string[] = [
    'finding',
    'device',
    'severity',
    'cveLink',
    'primaryCwe',
    'status',
  ];
  dataSource: MatTableDataSource<any> = new MatTableDataSource<any>();
}
